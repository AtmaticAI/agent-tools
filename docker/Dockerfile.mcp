# MCP Server only
FROM node:20-alpine

WORKDIR /app

# Install pnpm
RUN corepack enable && corepack prepare pnpm@9.15.0 --activate

# Copy package files
COPY package.json pnpm-workspace.yaml ./
COPY packages/agent-tools/package.json ./packages/agent-tools/

# Install dependencies
RUN pnpm install --frozen-lockfile

# Copy source and build
COPY packages/agent-tools ./packages/agent-tools

RUN pnpm build --filter=@atmaticai/agent-tools

# Create non-root user
RUN addgroup --system --gid 1001 nodejs
RUN adduser --system --uid 1001 agent-tools
USER agent-tools

EXPOSE 3001

ENV NODE_ENV=production
ENV MCP_PORT=3001
ENV MCP_TRANSPORT=http

CMD ["node", "packages/agent-tools/dist/cli.js", "--transport", "http", "--port", "3001"]
